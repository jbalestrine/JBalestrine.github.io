<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U Player</title>
    <style>
        body { font-family: sans-serif; display: flex; margin: 0; padding: 0; background-color: #f0f0f0; }
        #sidebar { width: 250px; background-color: #333; color: white; padding: 15px; overflow-y: auto; height: 100vh; box-shadow: 2px 0 5px rgba(0,0,0,0.2); }
        #main-content { flex-grow: 1; padding: 20px; }
        #search-container { margin-bottom: 20px; }
        #search-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        #player-container { margin-bottom: 20px; background-color: black; }
        video { width: 100%; height: auto; display: block; }
        .category-section h3 { margin-top: 20px; color: #555; }
        .channel-list { list-style: none; padding: 0; }
        .channel-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.2s; }
        .channel-item:hover { background-color: #e9e9e9; }
        .channel-item img { width: 50px; height: 50px; object-fit: cover; margin-right: 10px; border-radius: 5px; }
        .channel-item .channel-name { font-weight: bold; }
        .channel-item .channel-genre { font-size: 0.9em; color: #777; }
        .favorite-btn { margin-left: auto; background: none; border: none; font-size: 1.2em; cursor: pointer; color: #ccc; }
        .favorite-btn.active { color: gold; }

        /* Sidebar channel item for selected state */
        #sidebar .channel-item {
            color: white;
            border-bottom: 1px solid #555;
        }
        #sidebar .channel-item:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Categories</h2>
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Search channels...">
        </div>
        <div id="category-sections">
            <div id="live-tv-category" class="category-section">
                <h3>Live TV</h3>
                <ul class="channel-list"></ul>
            </div>
            <div id="movies-category" class="category-section">
                <h3>Movies</h3>
                <ul class="channel-list"></ul>
            </div>
            <div id="series-category" class="category-section">
                <h3>Series</h3>
                <ul class="channel-list"></ul>
            </div>
            <div id="favorites-category" class="category-section">
                <h3>Favorites</h3>
                <ul class="channel-list"></ul>
            </div>
            </div>
    </div>

    <div id="main-content">
        <h1>M3U Player</h1>
        <div id="player-container">
            <video id="video-player" controls autoplay></video>
        </div>
        <div id="current-channel-info">
            <h2>Now Playing: <span id="current-channel-name">None</span></h2>
            <p>Genre: <span id="current-channel-genre">N/A</span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('search-input');
    const videoPlayer = document.getElementById('video-player');
    const currentChannelNameElem = document.getElementById('current-channel-name');
    const currentChannelGenreElem = document.getElementById('current-channel-genre');

    const categories = {
        'Live TV': document.querySelector('#live-tv-category .channel-list'),
        'Movies': document.querySelector('#movies-category .channel-list'),
        'Series': document.querySelector('#series-category .channel-list'),
        'Favorites': document.querySelector('#favorites-category .channel-list'),
        // Add more categories as needed
    };

    let allChannels = []; // Store all parsed channels

    // Function to fetch and parse the M3U file
    async function loadM3U() {
        // IMPORTANT: Replace this with an authorized/local M3U URL or fetch from a controlled source.
        // I am using a placeholder for illustration. Directly using the provided URL is NOT recommended.
        const m3uUrl = ' http://1tv41.icu:8080/get.php?username=3022207888&password=leonmatthews60@gmail.com&type=m3u'; // <<< Replace with your actual M3U URL

        try {
            const response = await fetch(m3uUrl);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const text = await response.text();
            parseM3U(text);
        } catch (error) {
            console.error('Error fetching M3U:', error);
            alert('Could not load playlist. Please check the M3U URL.');
        }
    }

    // Function to parse the M3U content based on your specific format
    function parseM3U(m3uText) {
        const lines = m3uText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        let currentChannel = {};
        allChannels = []; // Reset for new parse

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i];

            if (line.startsWith('N.')) {
                currentChannel.name = line.substring(2).trim();
            } else if (line.startsWith('G.')) {
                currentChannel.genre = line.substring(2).trim();
            } else if (line.startsWith('S.')) {
                currentChannel.url = line.substring(2).trim();
                // At this point, we have a complete channel entry
                // Assuming you have an image mapping or can derive it
                currentChannel.image = getImageForChannel(currentChannel.name); // You need to implement this
                allChannels.push({ ...currentChannel }); // Add a copy to allChannels
                currentChannel = {}; // Reset for the next channel
            }
            // Ignore other lines like #EXTTVL, #EXTFINFN, etc. for channel parsing
        }
        displayChannels(allChannels);
        loadFavorites(); // Load favorites after channels are parsed
    }

    // Helper function to get an image URL for a channel
    // This is crucial and needs your implementation.
    // Options:
    // 1. Have a separate JSON mapping: { "Channel Name": "image_url.png" }
    // 2. Derive from channel name (e.g., "channel_name_logo.png")
    // 3. (Less common in M3U) M3U itself has a 'tvg-logo' attribute in #EXTINF line
    function getImageForChannel(channelName) {
        // Placeholder: In a real scenario, you'd have a mapping or logic here
        // For demonstration, let's just return a generic placeholder
        return 'https://via.placeholder.com/50x50?text=' + encodeURIComponent(channelName.charAt(0));
    }


    // Function to display channels in their respective categories
    function displayChannels(channelsToDisplay) {
        // Clear existing lists
        Object.values(categories).forEach(list => list.innerHTML = '');

        channelsToDisplay.forEach(channel => {
            const li = document.createElement('li');
            li.className = 'channel-item';
            li.dataset.url = channel.url;
            li.dataset.name = channel.name;
            li.dataset.genre = channel.genre;

            li.innerHTML = `
                <img src="${channel.image}" alt="${channel.name} logo">
                <div class="channel-info">
                    <div class="channel-name">${channel.name}</div>
                    <div class="channel-genre">${channel.genre}</div>
                </div>
                <button class="favorite-btn" data-name="${channel.name}">⭐</button>
            `;

            li.addEventListener('click', (event) => {
                // Prevent playing if favorite button was clicked
                if (!event.target.classList.contains('favorite-btn')) {
                    playChannel(channel.url, channel.name, channel.genre);
                }
            });

            // Handle favorite button click
            const favBtn = li.querySelector('.favorite-btn');
            favBtn.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent li click event from firing
                toggleFavorite(channel.name);
                favBtn.classList.toggle('active', isFavorite(channel.name)); // Update star color
                filterChannels(searchInput.value); // Re-render to update favorite section
            });

            // Assign to category
            const targetCategoryList = categories[channel.genre] || categories['Live TV']; // Default to Live TV if genre not found
            if (targetCategoryList) {
                targetCategoryList.appendChild(li);
            }
        });
        updateFavoriteButtons(); // Update star color on initial display
    }

    // Function to play a channel
    function playChannel(url, name, genre) {
        videoPlayer.src = url;
        videoPlayer.load();
        videoPlayer.play();
        currentChannelNameElem.textContent = name;
        currentChannelGenreElem.textContent = genre;
        console.log(`Playing: ${name} (${url})`);
    }

    // Search functionality
    searchInput.addEventListener('input', (event) => {
        filterChannels(event.target.value);
    });

    function filterChannels(searchTerm) {
        const lowerCaseSearchTerm = searchTerm.toLowerCase();
        const filteredChannels = allChannels.filter(channel =>
            channel.name.toLowerCase().includes(lowerCaseSearchTerm) ||
            channel.genre.toLowerCase().includes(lowerCaseSearchTerm)
        );

        // Separate out favorites for display
        const favoritedChannels = filteredChannels.filter(channel => isFavorite(channel.name));
        const nonFavoritedChannels = filteredChannels.filter(channel => !isFavorite(channel.name));

        // Clear and re-populate only the visible categories
        Object.values(categories).forEach(list => list.innerHTML = '');

        // Populate favorites
        favoritedChannels.forEach(channel => {
            const li = createChannelListItem(channel);
            categories['Favorites'].appendChild(li);
        });

        // Populate other categories
        nonFavoritedChannels.forEach(channel => {
            const li = createChannelListItem(channel);
            const targetCategoryList = categories[channel.genre] || categories['Live TV'];
            if (targetCategoryList) {
                targetCategoryList.appendChild(li);
            }
        });
        updateFavoriteButtons();
    }

    // Helper to create channel list item with event listeners
    function createChannelListItem(channel) {
        const li = document.createElement('li');
        li.className = 'channel-item';
        li.dataset.url = channel.url;
        li.dataset.name = channel.name;
        li.dataset.genre = channel.genre;

        li.innerHTML = `
            <img src="${channel.image}" alt="${channel.name} logo">
            <div class="channel-info">
                <div class="channel-name">${channel.name}</div>
                <div class="channel-genre">${channel.genre}</div>
            </div>
            <button class="favorite-btn" data-name="${channel.name}">⭐</button>
        `;

        li.addEventListener('click', (event) => {
            if (!event.target.classList.contains('favorite-btn')) {
                playChannel(channel.url, channel.name, channel.genre);
            }
        });

        const favBtn = li.querySelector('.favorite-btn');
        favBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            toggleFavorite(channel.name);
            filterChannels(searchInput.value); // Re-render to update favorite section
        });
        return li;
    }


    // Dynamic Personalization (Favorites using sessionStorage)
    // sessionStorage is used here for "expires once the user exits" behavior.
    // Use localStorage if you want persistence across browser sessions.
    const FAVORITES_KEY = 'm3u_player_favorites';
    let favorites = new Set(); // Using a Set for efficient lookup

    function loadFavorites() {
        const storedFavorites = sessionStorage.getItem(FAVORITES_KEY);
        if (storedFavorites) {
            favorites = new Set(JSON.parse(storedFavorites));
        }
        filterChannels(searchInput.value); // Re-render to show favorites
    }

    function saveFavorites() {
        sessionStorage.setItem(FAVORITES_KEY, JSON.stringify(Array.from(favorites)));
    }

    function isFavorite(channelName) {
        return favorites.has(channelName);
    }

    function toggleFavorite(channelName) {
        if (isFavorite(channelName)) {
            favorites.delete(channelName);
        } else {
            favorites.add(channelName);
        }
        saveFavorites();
        updateFavoriteButtons(); // Update all buttons
    }

    function updateFavoriteButtons() {
        document.querySelectorAll('.favorite-btn').forEach(button => {
            const channelName = button.dataset.name;
            if (isFavorite(channelName)) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
    }

    // Initial load
    loadM3U();
});
    </script>
</body>
</html>
