<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Channel Listings</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Existing styles... */
    </style>
</head>
<body>

<header>
    <h1>IPTV Channel Listings</h1>
    <input type="text" id="searchBar" class="search-bar" placeholder="Search IPTV Channels..." onkeyup="searchChannels()">
</header>

<!-- Favorites Section -->
<div id="favoritesSection">
    <h2>Favorites</h2>
    <ul id="favoritesList" class="favorites-list">
        <!-- Favorite channels will be dynamically listed here -->
    </ul>
</div>

<!-- Alphabetical Filter -->
<div class="alphabetical-filter" id="alphabeticalFilter">
    <!-- Alphabet letters will be dynamically added here -->
</div>

<div class="container">
    <!-- Category List -->
    <div id="categoryList" class="category-list">
        <!-- Categories will be dynamically loaded here -->
    </div>

    <!-- Channel List -->
    <div id="channelList" class="category">
        <h2>All Channels</h2>
        <ul id="channelItems" class="channel-list">
            <!-- Channel list will be populated here dynamically -->
        </ul>
    </div>
</div>

<!-- Fixed Video Player -->
<div class="video-player" id="videoPlayerContainer">
    <video id="videoPlayer" controls>
        <source id="videoSource" src="" type="application/x-mpegURL">
        Your browser does not support the video tag.
    </video>
</div>

<script>
    let categories = {}; // To store channels organized by categories
    let allChannels = []; // To store all channels for alphabetical filtering
    let favorites = []; // To store favorite channels

    // Function to load XSPF file using XMLHttpRequest
    function loadXSPF() {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'newjb.xspf', true); // Replace with your actual XSPF file path
        xhr.setRequestHeader('Content-Type', 'application/xml');
        
        xhr.onload = function () {
            if (xhr.status === 200) {
                const xmlData = xhr.responseText;
                renderCategories(xmlData); // Parse and render categories and channels
            } else {
                console.error('Failed to load XSPF file');
            }
        };

        xhr.onerror = function () {
            console.error('Error occurred while fetching XSPF file');
        };

        xhr.send();
    }

    // Function to parse the XSPF file and render categories and channels
    function renderCategories(xmlData) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlData, 'application/xml');
        const trackList = xmlDoc.getElementsByTagName('track');
        
        categories = { 'Series': [], 'Movies': [] };  // Reset categories for new data
        allChannels = [];  // Reset all channels for alphabetical filter

        // Parse the XSPF and organize channels into 'Series' and 'Movies'
        for (let i = 0; i < trackList.length; i++) {
            const track = trackList[i];

            const title = track.getElementsByTagName('title')[0] ? track.getElementsByTagName('title')[0].textContent : "Untitled";
            const location = track.getElementsByTagName('location')[0] ? track.getElementsByTagName('location')[0].textContent : "No Location";
            const description = track.getElementsByTagName('annotation')[0] ? track.getElementsByTagName('annotation')[0].textContent : "No Description";

            // Categorize based on the URL (location)
            if (location.toLowerCase().includes('series')) {
                categories['Series'].push({ title, location, description });
            } else if (location.toLowerCase().includes('movie')) {
                categories['Movies'].push({ title, location, description });
            }

            allChannels.push({ title, location, description });
        }

        // Render categories list
        const categoryListElement = document.getElementById('categoryList');
        categoryListElement.innerHTML = ''; // Clear previous categories

        // Add Series and Movies categories
        for (const category in categories) {
            const categoryItem = document.createElement('li');
            categoryItem.textContent = category;
            categoryItem.onclick = () => loadChannels(category);
            categoryListElement.appendChild(categoryItem);
        }

        // Render the Alphabetical Filter
        renderAlphabeticalFilter();
        
        // Load default category (Series)
        loadChannels('Series');
    }

    // Function to render the alphabetical filter (A-Z)
    function renderAlphabeticalFilter() {
        const alphabeticalFilterElement = document.getElementById('alphabeticalFilter');
        alphabeticalFilterElement.innerHTML = ''; // Clear previous filter

        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        letters.forEach(letter => {
            const letterLink = document.createElement('a');
            letterLink.href = '#';
            letterLink.textContent = letter;
            letterLink.onclick = () => filterByLetter(letter);
            alphabeticalFilterElement.appendChild(letterLink);
        });
    }

    // Function to filter channels by the selected letter and display them under "All Channels"
    function filterByLetter(letter) {
        const filteredChannels = allChannels.filter(channel => {
            return channel.title && channel.title[0].toUpperCase() === letter;
        });

        // Display the filtered channels in the "All Channels" section
        const channelListElement = document.getElementById('channelItems');
        channelListElement.innerHTML = ''; // Clear previous list
        filteredChannels.forEach(channel => {
            const channelItem = document.createElement('li');
            channelItem.className = 'channel-item';
            channelItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            channelItem.onclick = () => playChannel(channel.location);
            channelItem.appendChild(createFavoriteButton(channel)); // Add favorite button
            channelListElement.appendChild(channelItem);
        });
    }

    // Function to load and display channels based on the selected category (Series or Movies)
    function loadChannels(category) {
        const channelListElement = document.getElementById('channelItems');
        channelListElement.innerHTML = ''; // Clear previous list

        const channels = categories[category];
        channels.forEach(channel => {
            const channelItem = document.createElement('li');
            channelItem.className = 'channel-item';
            channelItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            channelItem.onclick = () => playChannel(channel.location);
            channelItem.appendChild(createFavoriteButton(channel)); // Add favorite button
            channelListElement.appendChild(channelItem);
        });
    }

    // Function to create a favorite button for each channel
    function createFavoriteButton(channel) {
        const favoriteButton = document.createElement('button');
        favoriteButton.textContent = '❤️';
        favoriteButton.style.marginLeft = '10px';
        favoriteButton.onclick = (e) => {
            e.stopPropagation(); // Prevent triggering the playChannel
            addFavorite(channel);
        };
        return favoriteButton;
    }

    // Function to add a channel to favorites
    function addFavorite(channel) {
        if (!favorites.includes(channel)) {
            favorites.push(channel);
            renderFavorites(); // Update the favorites section
        }
    }

    // Function to render the favorites section
    function renderFavorites() {
        const favoritesListElement = document.getElementById('favoritesList');
        favoritesListElement.innerHTML = ''; // Clear previous favorites

        favorites.forEach(channel => {
            const favoritesItem = document.createElement('li');
            favoritesItem.className = 'favorites-item';
            favoritesItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            favoritesItem.onclick = () => playChannel(channel.location);
            favoritesListElement.appendChild(favoritesItem);
        });
    }

    // Function to play the selected channel in the video player
    function playChannel(url) {
        const videoPlayerContainer = document.getElementById('videoPlayerContainer');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoSource = document.getElementById('videoSource');

        // Update the source and play the video
        videoSource.src = url;
        videoPlayer.load();
        videoPlayer.play();

        // Show the video player when a channel is clicked
        videoPlayerContainer.style.display = 'block'; // Display the player
    }

    // Search functionality for IPTV channels
    function searchChannels() {
        const query = document.getElementById('searchBar').value.toLowerCase();
        const filteredChannels = [];

        // Filter channels across all categories
        for (const category in categories) {
            categories[category].forEach(channel => {
                if (channel.title.toLowerCase().includes(query) || channel.description.toLowerCase().includes(query)) {
                    filteredChannels.push(channel);
                }
            });
        }

        // Display the search results in the channel list
        const channelListElement = document.getElementById('channelItems');
        channelListElement.innerHTML = '';
        filteredChannels.forEach(channel => {
            const channelItem = document.createElement('li');
            channelItem.className = 'channel-item';
            channelItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            channelItem.onclick = () => playChannel(channel.location);
            channelItem.appendChild(createFavoriteButton(channel)); // Add favorite button
            channelListElement.appendChild(channelItem);
        });
    }

    // Initialize the page by loading XSPF file
    loadXSPF();
</script>

</body>
</html>
