<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Channel Listings</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Fixed Video Player Styling */
        .video-player {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 640px;
            height: 360px;
            background-color: #000;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 1000;
            display: none;
        }

        video {
            width: 100%;
            height: 100%;
            background-color: #000;
        }

        /* Container */
        .container {
            margin-right: 660px;
        }

        /* Category List */
        #categoryList {
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Channel Item Styling */
        .channel-item {
            padding: 10px;
            margin: 5px;
            background-color: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
        }

        .channel-item:hover {
            background-color: #e0e0e0;
        }

        /* Load Playlist Button */
        #loadPlaylistButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #loadPlaylistButton:hover {
            background-color: #45a049;
        }

        #playlistSelector {
            padding: 10px 0;
        }
    </style>
</head>
<body>

<header>
    <h1>IPTV Channel Listings</h1>
    <input type="text" id="searchBar" class="search-bar" placeholder="Search IPTV Channels..." onkeyup="searchChannels()">
</header>

<!-- Playlist Selector -->
<div id="playlistSelector">
    <button id="loadPlaylistButton" onclick="loadPlaylist('newjb.xspf')">Load Playlist 1</button>
    <button id="loadPlaylistButton" onclick="loadPlaylist('newjb.xspf')">Load local stations only</button>
</div>

<!-- Category List -->
<div id="categoryList" class="category-list">
    <!-- Categories will be dynamically loaded here -->
</div>

<!-- Channel List -->
<div class="container">
    <div id="channelList" class="category">
        <h2>All Channels</h2>
        <ul id="channelItems" class="channel-list">
            <!-- Channel list will be populated here dynamically -->
        </ul>
    </div>
</div>

<!-- Fixed Video Player -->
<div class="video-player" id="videoPlayerContainer">
    <video id="videoPlayer" controls>
        <source id="videoSource" src="" type="application/x-mpegURL">
        Your browser does not support the video tag.
    </video>
</div>

<script>
    let categories = {}; // To store channels organized by categories
    let allChannels = []; // To store all channels for alphabetical filtering

    // Function to load the XSPF playlist
    function loadPlaylist(playlistFile) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', playlistFile, true); // Load the selected playlist
        xhr.setRequestHeader('Content-Type', 'application/xml');
        
        xhr.onload = function () {
            if (xhr.status === 200) {
                const xmlData = xhr.responseText;
                renderCategories(xmlData); // Parse and render categories and channels
            } else {
                console.error('Failed to load XSPF playlist');
            }
        };

        xhr.onerror = function () {
            console.error('Error occurred while fetching XSPF playlist');
        };

        xhr.send();
    }

    // Function to parse the XSPF file and render categories and channels
    function renderCategories(xmlData) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlData, 'application/xml');
        const trackList = xmlDoc.getElementsByTagName('track');
        
        categories = {};  // Reset categories for new data
        allChannels = [];  // Reset all channels for alphabetical filter

        // Parse the XSPF and organize channels by category and collect all channels
        for (let i = 0; i < trackList.length; i++) {
            const track = trackList[i];

            const title = track.getElementsByTagName('title')[0] ? track.getElementsByTagName('title')[0].textContent : "Untitled";
            const location = track.getElementsByTagName('location')[0] ? track.getElementsByTagName('location')[0].textContent : "No Location";
            const creator = track.getElementsByTagName('creator')[0] ? track.getElementsByTagName('creator')[0].textContent : "Unknown Creator";
            const description = track.getElementsByTagName('annotation')[0] ? track.getElementsByTagName('annotation')[0].textContent : "No Description";

            // Organize tracks by category (creator)
            if (!categories[creator]) {
                categories[creator] = [];
            }

            categories[creator].push({ title, location, description });
            allChannels.push({ title, location, description });
        }

        // Render categories list
        const categoryListElement = document.getElementById('categoryList');
        categoryListElement.innerHTML = ''; // Clear previous categories

        for (const category in categories) {
            const categoryItem = document.createElement('li');
            categoryItem.textContent = category;
            categoryItem.onclick = () => loadChannels(category);
            categoryListElement.appendChild(categoryItem);
        }

        // Load default category (first category)
        loadChannels(Object.keys(categories)[0]);
    }

    // Function to load and display channels based on the selected category
    function loadChannels(category) {
        const channelListElement = document.getElementById('channelItems');
        channelListElement.innerHTML = ''; // Clear previous list

        const channels = categories[category];
        channels.forEach(channel => {
            const channelItem = document.createElement('li');
            channelItem.className = 'channel-item';
            channelItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            channelItem.onclick = () => playChannel(channel.location);
            channelListElement.appendChild(channelItem);
        });
    }

    // Function to play the selected channel in the video player
    function playChannel(url) {
        const videoPlayerContainer = document.getElementById('videoPlayerContainer');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoSource = document.getElementById('videoSource');

        // Update the source and play the video
        videoSource.src = url;
        videoPlayer.load();
        videoPlayer.play();

        // Show the video player when a channel is clicked
        videoPlayerContainer.style.display = 'block'; // Display the player
    }

    // Search functionality for IPTV channels
    function searchChannels() {
        const query = document.getElementById('searchBar').value.toLowerCase();
        const filteredChannels = [];

        // Filter channels across all categories
        for (const category in categories) {
            categories[category].forEach(channel => {
                if (channel.title.toLowerCase().includes(query) || channel.description.toLowerCase().includes(query)) {
                    filteredChannels.push(channel);
                }
            });
        }

        // Display the search results in the channel list
        const channelListElement = document.getElementById('channelItems');
        channelListElement.innerHTML = '';
        filteredChannels.forEach(channel => {
            const channelItem = document.createElement('li');
            channelItem.className = 'channel-item';
            channelItem.innerHTML = `<strong>${channel.title}</strong><br><em>${channel.description}</em>`;
            channelItem.onclick = () => playChannel(channel.location);
            channelListElement.appendChild(channelItem);
        });
    }

    // Initialize the page by loading a default playlist (e.g., playlist1.xspf)
    loadPlaylist('playlist1.xspf');
</script>

</body>
</html>
